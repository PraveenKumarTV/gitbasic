<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Excel and Insert to MySQL</title>
    <!-- Include the SheetJS library for reading Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        input[type="text"] {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h2>Upload Excel and Insert into MySQL</h2>

    <!-- File input to upload Excel file -->
    <input type="file" id="excelFile" accept=".xls,.xlsx" />
    <br><br>

    <!-- Table to display the Excel data -->
    <table id="excelTable">
        <!-- Table rows will be populated here -->
    </table>

    <!-- Button to save data to the database -->
    <button id="saveDataBtn">Save Data to Database</button>

    <script>
        document.getElementById('excelFile').addEventListener('change', function(event) {
            var file = event.target.files[0];
            if (!file) return;

            var reader = new FileReader();
            reader.onload = function(e) {
                var data = e.target.result;

                // Parse the Excel file using SheetJS
                var workbook = XLSX.read(data, {
                    type: 'binary'
                });

                // Get the first sheet (or modify this to handle multiple sheets)
                var sheet = workbook.Sheets[workbook.SheetNames[0]];
                
                // Convert the sheet into an array of rows (each row is an array of cell values)
                var rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // Display the rows in an HTML table
                displayTable(rows);
            };
            reader.readAsBinaryString(file);
        });

        function displayTable(data) {
            var table = document.getElementById('excelTable');
            table.innerHTML = '';  // Clear any existing table content

            data.forEach(function(row, rowIndex) {
                var tr = document.createElement('tr');

                row.forEach(function(cell, cellIndex) {
                    var td = document.createElement('td');

                    // For the first row (header), make the cells editable
                    if (rowIndex === 0) {
                        td.innerHTML = `<input type="text" value="${cell}" />`;
                    } else {
                        td.textContent = cell;
                    }

                    tr.appendChild(td);
                });

                table.appendChild(tr);
            });
        }

        // Save data to the database when the button is clicked
        document.getElementById('saveDataBtn').addEventListener('click', function() {
            var table = document.getElementById('excelTable');
            var rows = [];

            // Loop through each row and collect the data
            for (var i = 1; i < table.rows.length; i++) {  // Start from 1 to skip header row
                var row = table.rows[i];
                var rowData = [];
                for (var j = 0; j < row.cells.length; j++) {
                    rowData.push(row.cells[j].textContent);
                }
                rows.push(rowData);
            }

            // Send data to PHP script via AJAX
            var xhr = new XMLHttpRequest();
            xhr.open("POST", "insert_data.php", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    alert("Data saved to the database!");
                }
            };

            // Convert the data to JSON and send it to the PHP script
            xhr.send(JSON.stringify({ rows: rows }));
        });
    </script>
</body>
</html>
